<%- include('partials/header', { title }) %>

<section class="hero">
  <div class="hero__content">
    <p class="hero__eyebrow">üåø ChƒÉm s√≥c kh√¥ng gian s·ªëng c·ªßa b·∫°n</p>
    <h1>C√¢y xanh, c·∫£m h·ª©ng v√† tr·∫£i nghi·ªám mua s·∫Øm tr·ªçn v·∫πn.</h1>
    <p class="hero__subtitle">
      ƒê·∫∑t mua c√¢y c·∫£nh, qu·∫£n l√Ω ƒë∆°n h√†ng, ƒë√°nh gi√° s·∫£n ph·∫©m v√† theo d√µi ∆∞u ƒë√£i ‚Äì t·∫•t c·∫£ trong m·ªôt n·ªÅn t·∫£ng duy nh·∫•t.
    </p>
    <div class="hero__cta">
      <% if (locals.isLoggedIn) { %>
        <a class="btn btn-primary" href="/shop">Kh√°m ph√° s·∫£n ph·∫©m</a>
        <% if (locals.role === 'admin') { %>
          <a class="btn btn-secondary" href="/admin/dashboard">V√†o b·∫£ng ƒëi·ªÅu khi·ªÉn</a>
        <% } else { %>
          <a class="btn btn-secondary" href="/cart">Xem gi·ªè h√†ng</a>
        <% } %>
      <% } else { %>
        <a class="btn btn-primary" href="/auth/register">B·∫Øt ƒë·∫ßu ngay</a>
        <a class="btn btn-secondary" href="/auth/login">ƒêƒÉng nh·∫≠p</a>
      <% } %>
    </div>
  </div>
  <div class="hero__media" aria-hidden="true"></div>
</section>

<section class="feature-grid">
  <div class="feature-section">
    <h2>D√†nh cho kh√°ch h√†ng</h2>
    <p class="feature-section__subtitle">
      T·ªëi ∆∞u h√†nh tr√¨nh mua c√¢y c·∫£nh v·ªõi tr·∫£i nghi·ªám c√° nh√¢n ho√°.
    </p>
    <div class="feature-cards">
      <% customerFeatures.forEach((f) => { %>
        <article class="feature-card">
          <h3><%= f.title %></h3>
          <p><%= f.desc %></p>
        </article>
      <% }) %>
    </div>
  </div>
</section>

<section class="feature-grid">
  <div class="feature-section">
    <h2>S·∫£n ph·∫©m m·ªõi</h2>
    <p class="feature-section__subtitle">
      Nh·ªØng m·∫´u c√¢y v√† ph·ª• ki·ªán v·ª´a c·∫≠p b·∫øn, s·∫µn s√†ng l√†m m·ªõi kh√¥ng gian c·ªßa b·∫°n.
    </p>
    <div class="product-grid">
      <% if (!latestProducts || latestProducts.length === 0) { %>
        <p style="color:var(--muted);">Ch∆∞a c√≥ s·∫£n ph·∫©m m·ªõi. B·∫°n h√£y quay l·∫°i sau nh√©!</p>
      <% } else { %>
        <% latestProducts.forEach((product) => { %>
          <article class="product-card">
            <a href="/shop/<%= product.slug %>">
              <img src="<%= Array.isArray(product.img) && product.img.length ? product.img[0] : '/images/default-plant.jpg' %>" alt="<%= product.name %>">
            </a>
            <div class="product-card__body">
              <h3><a href="/shop/<%= product.slug %>"><%= product.name %></a></h3>
              <p class="price"><%= (product.price || 0).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' }) %></p>
              <a class="btn btn-secondary" href="/shop/<%= product.slug %>">Xem chi ti·∫øt</a>
            </div>
          </article>
        <% }) %>
      <% } %>
    </div>
  </div>
</section>

<section class="feature-grid">
  <div class="feature-section">
    <h2>S·∫£n ph·∫©m b√°n ch·∫°y</h2>
    <p class="feature-section__subtitle">
      Danh s√°ch ƒë∆∞·ª£c c·∫≠p nh·∫≠t theo l∆∞·ª£t mua th·ª±c t·∫ø, gi√∫p b·∫°n d·ªÖ d√†ng b·∫Øt k·ªãp xu h∆∞·ªõng.
    </p>
    <div class="product-grid">
      <% if (!bestSellers || bestSellers.length === 0) { %>
        <p style="color:var(--muted);">Ch∆∞a c√≥ d·ªØ li·ªáu s·∫£n ph·∫©m n·ªïi b·∫≠t. H√£y quay l·∫°i sau nh√©!</p>
      <% } else { %>
        <% bestSellers.forEach((product) => { 
             const firstVariant = Array.isArray(product.variants) && product.variants.length ? product.variants[0] : null;
        %>
          <article class="product-card">
            <a href="/shop/<%= product.slug %>">
              <img src="<%= Array.isArray(product.img) && product.img.length ? product.img[0] : '/images/default-plant.jpg' %>" alt="<%= product.name %>">
            </a>
            <div class="product-card__body">
              <h3><a href="/shop/<%= product.slug %>"><%= product.name %></a></h3>
              <p class="price"><%= (product.price || 0).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' }) %></p>
              <p style="color:var(--muted); font-size: 0.9rem;">ƒê√£ b√°n <%= product.soldCount || 0 %> s·∫£n ph·∫©m</p>
              <div class="best-card__actions">
                <a class="btn btn-primary" href="/shop/<%= product.slug %>">Xem chi ti·∫øt</a>
                <form method="POST" action="/cart/add">
                  <input type="hidden" name="productId" value="<%= product._id %>">
                  <% if (firstVariant) { %>
                    <input type="hidden" name="variantId" value="<%= firstVariant._id %>">
                  <% } %>
                  <input type="hidden" name="quantity" value="1">
                  <button class="btn btn-secondary" type="submit">Th√™m v√†o gi·ªè</button>
                </form>
              </div>
            </div>
          </article>
        <% }) %>
      <% } %>
    </div>
  </div>
</section>

<% if (Array.isArray(categorySections) && categorySections.length) { %>
  <% categorySections.forEach((section) => { %>
    <section class="feature-grid">
      <div class="feature-section">
        <div class="feature-section__header">
          <h2><%= section.title %></h2>
          <a class="pill" href="/shop?category=<%= section.slug %>">Xem t·∫•t c·∫£</a>
        </div>
        <p class="feature-section__subtitle">
          G·ª£i √Ω n·ªïi b·∫≠t trong danh m·ª•c <%= section.title.toLowerCase() %>.
        </p>
        <div class="product-grid">
          <% if (!section.products || section.products.length === 0) { %>
            <p style="color:var(--muted);">Ch∆∞a c√≥ s·∫£n ph·∫©m trong danh m·ª•c n√†y.</p>
          <% } else { %>
            <% section.products.forEach((product) => { 
                 const firstVariant = Array.isArray(product.variants) && product.variants.length ? product.variants[0] : null;
            %>
              <article class="product-card">
                <a href="/shop/<%= product.slug %>">
                  <img src="<%= Array.isArray(product.img) && product.img.length ? product.img[0] : '/images/default-plant.jpg' %>" alt="<%= product.name %>">
                </a>
                <div class="product-card__body">
                  <h3><a href="/shop/<%= product.slug %>"><%= product.name %></a></h3>
                  <p class="price"><%= (product.price || 0).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' }) %></p>
                  <div class="best-card__actions">
                    <a class="btn btn-secondary" href="/shop/<%= product.slug %>">Xem chi ti·∫øt</a>
                    <form method="POST" action="/cart/add">
                      <input type="hidden" name="productId" value="<%= product._id %>">
                      <% if (firstVariant) { %>
                        <input type="hidden" name="variantId" value="<%= firstVariant._id %>">
                      <% } %>
                      <input type="hidden" name="quantity" value="1">
                      <button class="btn btn-primary" type="submit">Mua nhanh</button>
                    </form>
                  </div>
                </div>
              </article>
            <% }) %>
          <% } %>
        </div>
      </div>
    </section>
  <% }) %>
<% } %>

<section class="callout">
  <div class="callout__content">
    <h2>∆Øu ƒë√£i xanh m·ªói tu·∫ßn</h2>
    <p>
      Th√™m c√¢y m·ªõi v√†o b·ªô s∆∞u t·∫≠p, theo d√µi ƒë∆°n h√†ng v√† t√≠ch ƒëi·ªÉm ƒë·ªïi qu√†. Ch√∫ng t√¥i giao t·∫≠n n∆°i v√† h·ªó tr·ª£ b·∫°n chƒÉm s√≥c t·ª´ng chi·∫øc l√°.
    </p>
  </div>
  <div class="callout__actions">
    <% if (locals.isLoggedIn) { %>
      <a class="btn btn-primary" href="/shop">Mua c√¢y ngay</a>
      <a class="btn btn-secondary" href="/orders">ƒê∆°n h√†ng c·ªßa t√¥i</a>
    <% } else { %>
      <a class="btn btn-primary" href="/auth/register">Tham gia c·ªông ƒë·ªìng</a>
      <a class="btn btn-secondary" href="/auth/login">T√¥i ƒë√£ c√≥ t√†i kho·∫£n</a>
    <% } %>
  </div>
</section>

<section class="info-columns">
  <article>
    <h3>V∆∞·ªùn c√¢y ƒë∆∞·ª£c ch·ªçn l·ªçc</h3>
    <p>H∆°n 150+ lo·∫°i c√¢y c·∫£nh ƒë∆∞·ª£c chƒÉm s√≥c k·ªπ l∆∞·ª°ng, ki·ªÉm ƒë·ªãnh tr∆∞·ªõc khi ƒë·∫øn tay kh√°ch h√†ng.</p>
  </article>
  <article>
    <h3>Giao h√†ng to√†n qu·ªëc</h3>
    <p>ƒê√≥ng g√≥i an to√†n, h·ªó tr·ª£ ƒë·ªïi tr·∫£ mi·ªÖn ph√≠ trong 48 gi·ªù n·∫øu c√¢y g·∫∑p s·ª± c·ªë ngo√†i √Ω mu·ªën.</p>
  </article>
  <article>
    <h3>H·ªó tr·ª£ 24/7</h3>
    <p>ƒê·ªôi ng≈© t∆∞ v·∫•n s·∫µn s√†ng gi·∫£i ƒë√°p th·∫Øc m·∫Øc chƒÉm s√≥c c√¢y v√† x·ª≠ l√Ω ƒë∆°n h√†ng b·∫•t k·ª≥ l√∫c n√†o.</p>
  </article>
</section>

<%- include('partials/footer') %>
